# 微信云开发配置指南

## 1. 开启云开发

### 在微信开发者工具中：
1. 打开项目设置
2. 勾选"启用云开发"
3. 创建云环境（如果没有的话）
4. 记录云环境ID

## 2. 配置云环境ID

### 更新以下文件中的云环境ID：

1. **utils/cloud.ts**
```typescript
const CLOUD_ENV = 'your-env-id'; // 替换为你的云环境ID
```

2. **cloudfunctions/config.json**
```json
{
  "env": "your-env-id" // 替换为你的云环境ID
}
```

## 3. 创建数据库集合

在云开发控制台中创建以下数据库集合：

### checkin_records（打卡记录集合）
- 权限设置：仅创建者可读写
- 字段结构：
  - `_id`: 自动生成的记录ID
  - `_openid`: 用户openid（自动添加）
  - `timestamp`: 打卡时间戳
  - `date`: 打卡日期
  - `time`: 打卡时间
  - `type`: 打卡类型（quick/detailed）
  - `note`: 备注信息
  - `customType`: 自定义类型
  - `location`: 位置信息
  - `createTime`: 创建时间

### user_profiles（用户信息集合）
- 权限设置：仅创建者可读写
- 字段结构：
  - `_id`: 用户openid
  - `nickName`: 用户昵称
  - `avatarUrl`: 头像URL
  - `gender`: 性别
  - `country`: 国家
  - `province`: 省份
  - `city`: 城市
  - `language`: 语言
  - `updateTime`: 更新时间

## 4. 部署云函数

### 部署login云函数：
1. 在微信开发者工具中，右键点击 `cloudfunctions/login` 文件夹
2. 选择"上传并部署：云端安装依赖"
3. 等待部署完成

## 5. 测试云开发功能

1. 在微信开发者工具中编译项目
2. 在模拟器中测试打卡功能
3. 检查云开发控制台中的数据是否正确保存

## 6. 权限配置

### 数据库权限：
- 设置为"仅创建者可读写"
- 确保用户只能访问自己的数据

### 云函数权限：
- 确保云函数有足够的权限访问数据库

## 7. 常见问题

### Q: 云函数调用失败
A: 检查云环境ID是否正确配置，确保云函数已正确部署

### Q: 数据库访问失败
A: 检查数据库集合权限设置，确保用户有读写权限

### Q: 数据同步问题
A: 检查网络连接，确保云开发服务正常

## 8. 性能优化

1. **数据分页**：对于大量数据，使用分页查询
2. **缓存策略**：合理使用本地缓存减少网络请求
3. **错误处理**：完善的错误处理和用户提示

## 9. 安全注意事项

1. **数据验证**：在云函数中验证用户输入
2. **权限控制**：严格控制数据库访问权限
3. **敏感信息**：不要在客户端存储敏感信息

## 10. 监控和维护

1. **日志监控**：定期检查云函数执行日志
2. **数据备份**：定期备份重要数据
3. **性能监控**：监控云开发资源使用情况 